<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
</head>
<body>
<style>
  
  form .txt_field{
    position: relative;
    border-bottom: 2px solid #adadad;
    margin: 30px 0;
  }
  
  .txt_field input{
    width: 100%;
    padding: 0 5px;
    height: 30px;
    font-size: 16px;
    border: none;
    background: none;
    outline: none;
  }
  
  .txt_field label{
    position: absolute;
    top: 50%;
    left: 5px;
    color: #adadad;
    transform: translateY(-50%);
    font-size: 16px;
    pointer-events: none;
  }
  
  .txt_field span::before{
    content: '';
    position: absolute;
    top: 40px;
    left: 0;
    width: 0px;
    height: 2px;
    background: #2691d9;
    transition: .5s;
  }
  

</style>
  
<div style=" position: relative; background: white">
  <div style="width: 100%; height:100%; left: 0px; top: 112px; position: absolute; background: white">
  <table style="margin : 3rem 0; ">
  <tbody>
    <tr>
      <td>
        <div style="padding-left : 5rem;color: #2b4910; font-size: 64px;  font-weight:bold; line-height: 76.80px; word-wrap: break-word">TemAn</div>
      </td>
      <td style=" width : 95%;">
        <div style="padding : 0 5%; width : 100%; "><span style="color: #2b4910; font-size: 20px; font-family: Inter; font-weight: 500; line-height: 26px; word-wrap: break-word">Pantau <b style="font-family:arial;">Tem</b>peratur dan kelembap<b style="font-family:arial;">An</b> secara realtime </span></div>
      </td>
      <td>
        <div id="default" style="padding-left: 16px; padding-right: 16px; padding-top: 9.50px; padding-bottom: 9.50px; left: 1077px; top: 76px;  background:#426B1F ; border-radius: 20px; overflow: hidden;  border: 1px #C2C2C2 solid;justify-content: center; align-items: center; display: inline-flex">
          <a style="text-align: center; color: white ; font-size: 16px; font-family: Inter; font-weight: 600; line-height: 20.80px; word-wrap: break-word ;  text-decoration:none;" href="">Default</a>
        </div>
      </td>
      <td>
        <div id="sort" style="padding-left: 16px; padding-right: 16px; padding-top: 9.50px; padding-bottom: 9.50px; left: 1173px; top: 76px;  background: '#426B1F'; border-radius: 20px; overflow: hidden; border: 1px #C2C2C2 solid; justify-content: center; align-items: center; display: inline-flex">
          <a style="text-align: center; color:black ; font-size: 16px; font-family: Inter; font-weight: 600; line-height: 20.80px; word-break: unset ; word-wrap: unset; white-space:nowrap; text-decoration:none;" href="">A-Z</a>
        </div>
      </td>
      <td style="padding-right:1rem;">
        <div id="available" style="padding-left: 16px; padding-right: 16px; padding-top: 9.50px; padding-bottom: 9.50px; left: 1243px; top: 76px;  background: white ; border-radius: 20px; overflow: hidden; border: 1px #C2C2C2 solid; justify-content: center; align-items: center; display: inline-flex">
          <a style="text-align: center; color:  black; font-size: 16px; font-family: Inter; font-weight: 600; line-height: 20.80px; word-wrap: break-word; white-space:nowrap;  text-decoration:none;" href="">Available</a>
        </div>
      </td>
    </tr>
    <tr >
      <td colspan="5" style="padding-left:5rem; padding-right:1rem;">
        <div style="width:100%; height: 0px;  top: 149px;  box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25); border: 2px #E6E6E6 solid"></div>
      </td>
    </tr>
  </tbody>
  </table>
  </div>
  <div style="width: 100%; height:auto; left: 0px; top: 0px; position: absolute">
    <div style="position:absolute; display:table-cell; top: 41px; left:5rem; padding-right:10px; align-content : center;" >
        <table>
          <tr>
            <td style="width:auto;">
              <div style=" color: #426B1F; font-size: 32px; font-family: Arial; font-weight: bold;  word-wrap: break-word" ><a href="home" style="text-decoration:none;  color: #426B1F;">M Chandra R</a></div>
            </td>
          </tr>
        </table>
      </div>
    <div style="position:absolute; display:table-cell; top: 41px; right:0;  align-content : center;" >
      <table>
        <tr>

          <td style="padding : 0 1rem ;">
            <a style="vertical-align :supper; top: 45.50px; float:left; text-align: center; color: black; font-size: 16px; font-family: Arial; font-weight: 400; line-height: 20.80px; word-wrap: break-word; font-weight:bold; text-decoration:none;" href="home">Home</a></a>
          </td>

          <td style="padding : 0 1rem ;">
            <a style="top: 45.50px; float:left; text-align: center; color: black; font-size: 16px; font-family: Arial; font-weight: 400; line-height: 20.80px; word-wrap: break-word; font-weight:bold; text-decoration:none;" href="profile">Profile Saya</a></div>
          </td>
          <td>
            <!-- Search bar -->
            <div style="padding-left: 16px; padding-right: 16px;  left: 1243px; top: 76px;  background: white; border-radius: 20px; overflow: hidden; border: 1px #C2C2C2 solid; justify-content: center; align-items: center; display: inline-flex">
                <div class="txt_field">
                  <input type="text" name="name" id="search" required>
                </div>
                <img width="20" id="searchicon" src="images/icon/search.png"/>
              </div>
            </div>         
          </td>
          <td style="padding : 0 1rem ;">
            <div style="padding-left: 23px; padding-right: 23px; padding-top: 13.50px; padding-bottom: 13.50px;  top: 32px; background: #426B1F; border-radius: 15px; overflow: hidden; justify-content: center; align-items: center; display: inline-flex">
              <a style="text-align: center; color: white; font-size: 16px; font-family: Arial; font-weight: 600; line-height: 20.80px; word-wrap: break-word ; text-decoration:none;" href="<?=strtolower($url)?>">Login</a>
            </div>
          </td>
        </tr>
      </table>

    </div>

  </div>
  <!-- Bagian container -->

  <div style="padding:0 5rem; float:left; position:absolute; top: 301px;" id="dataArea">
    
  </div>
 
</div>
<!-- Tombol add job -->
<div data-bs-toggle="modal" data-bs-target="#exampleModal" style="position:fixed;padding-left: 23px; padding-right: 23px; padding-top: 13.50px; padding-bottom: 13.50px;  bottom: 1rem; right : 1rem; background: #426B1F; border-radius: 15px; overflow: hidden; justify-content: center; align-items: center; display: inline-flex">
  <a style="text-align: center; color: white; font-size: 16px; font-family: Arial; font-weight: 600; line-height: 20.80px; word-wrap: break-word ; text-decoration:none;">Bantuan</a>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Posting Pekerjaan untuk pada job finder !</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Form Pengajuan job -->
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Nama Pekerjaan</label>
          <input type="email" class="form-control" id="jobName" placeholder="Masukkan nama pekerjaan ">
        </div>
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Deskripsi</label>
          <input type="email" class="form-control" id="jobDesc" placeholder="Deskripsikan seperti apa pekerjaanmu !">
        </div>
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Tipe Pekerjaan</label>
          <select class="form-select" aria-label="Default select example" id="jobType"required>
            <option selected value = "" >Pilih tipe pekerjaan</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Recruitment Start</label>
          <input type="date" class="form-control" id="jobStart" placeholder="Deskripsikan seperti apa pekerjaanmu !">
        </div>
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Recruitment End</label>
          <input type="date" class="form-control" id="jobEnd" placeholder="Deskripsikan seperti apa pekerjaanmu !">
        </div>
        <!-- end -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        <button type="button" class="btn btn-primary" id="postJob">Posting</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel" style="font-weight:bold;">Detail Suhu dan Kelembapan</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Form Pengajuan job -->
        <div >
          <label for="staticEmail" class="col-sm-2 col-form-label" style="font-weight:bold;"">Sensor_ID</label>
          <div class="col-lm-10">
            <input type="text" readonly class="form-control me-2" id="sensorField" value="">
          </div>
        </div>
        <div>
          <label for="staticEmail" class="col-sm-2 col-form-label" style="font-weight:bold;"">Lokasi</label>
          <div class="col-lm-10">
            <input type="text" readonly class="form-control me-2" id="locationField" value=""">
          </div>
        </div>
        <div>
          <label for="staticEmail" class="col-sm-2 col-form-label" style="font-weight:bold;">Temperatur</label>
          <div class="col-lm-10">
            <input type="text" readonly class="form-control me-2" id="tempField" value="">
          </div>
        </div>
        <div >
          <label for="staticEmail" class="col-sm-2 col-form-label" style="font-weight:bold;">Kelembapan</label>
          <div class="col-lm-10">
            <input type="text" readonly class="form-control me-2" id="humField" value="">
          </div>
        </div>
        <div >
          <label for="staticEmail" class=" col-form-label" style="font-weight:bold;">Terakhir Diupdate</label>
          <div class="col-lm-10">
            <input type="text" readonly class="form-control me-2" id="updateField" value="">
          </div>
        </div>
        <!-- end -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

</body>
<script>
    let dataArea = document.getElementById("dataArea");
    let waktuFormatted = "";
    let curData = {};
    let sensorField = document.getElementById("sensorField");
    let locationField = document.getElementById("locationField");
    let tempField = document.getElementById("tempField");
    let humField = document.getElementById("humField");
    let updateField = document.getElementById("updateField");

    function card(data){
        console.log("info");
        let status = parseInt(data.temp) >= 37 ? "Cuaca Terik" : "Normal";
        let color = parseInt(data.temp) >= 37 ? "Orange" : "#426B1F";
        let last_update = data.last_updated;
       
            
        let pastMenit = parseInt(waktuFormatted.substr(14,2))-parseInt(data.last_updated.substr(14,2));
        let pastJam = (parseInt(waktuFormatted.substr(11,2))-parseInt(data.last_updated.substr(11,2))) * 60;
        let pastHari = (parseInt(waktuFormatted.substr(8,2))-parseInt(data.last_updated.substr(8,2))) * 60 * 24;
        let totalWaktu = pastMenit + pastJam + pastHari;
        
        if(totalWaktu>=60 * 24){
          last_update = parseInt(totalWaktu/(60*24)) + " Hari lalu";
        }else if(totalWaktu >= 60){
          last_update = parseInt(totalWaktu/60) + " Jam lalu";
        }else if(totalWaktu > 0 ){
          last_update = totalWaktu + " Menit lalu";
        }else{
          last_update = "Baru saja";
        }

        return '<div style="float:left;width: 23rem; border:1;height: auto; margin-bottom : 20px; margin-right:20px; left: 523px; top: 301px; background: #FAFAF5; border-radius: 24px; overflow: hidden;" >'+
            '<table ><tr><td style="position:relative;"><span style="position:absolute; right:10px; bottom:10px; color:#426B1F;">'+last_update+'</span><img style="width: 23rem; height:12rem; left: 0px; top: 0px; " src="https://img.freepik.com/free-photo/white-cloud-blue-sky-sea_74190-4488.jpg?w=740&t=st=1713113490~exp=1713114090~hmac=1a16e61b94ec4176ca037c51f812a93375e632e6e8d95c16c59d0da7bfef236d" /></td></tr>' +
             ' <tr> <td  style="padding:0 10px;"><div style="left: 24px; top: 320px;  color: black; font-size: 20px; font-family: Inter; font-weight: 600; line-height: 26px; word-wrap: break-word">'+data.location+'</div> </td></tr>' +
            ' <tr> <td style="padding:0 10px;"> <div style="left: 24px; top: 350px;  color: '+color+'; font-size: 16px; font-family: Inter; font-weight: 600; line-height: 26px; word-wrap: break-word">'+status+'</div> </td></tr> ' +
             ' <tr> <td  style="padding:0 10px;"><div style="left: 24px; top: 392px;  color: #6D6D6D; font-size: 16px; font-family: Inter; font-weight: 400; line-height: 24px; word-wrap: break-word"><span>Suhu : '+data.temp+'°C</span><br><span>Kelembapan : '+data.hum+'%</span></div></td> </tr> ' +
             ' <tr> <td style="padding:50px 20px; position:relative; "> <div onClick="showDetail(`'+data.sensor_id+'`)" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style="position:absolute; right:20px;padding-left: 23px; padding-right: 23px; padding-top: 13.50px; padding-bottom: 13.50px;  top: 32px; background: #426B1F; border-radius: 8px; overflow: hidden; justify-content: center; align-items: center; display: inline-flex">'+
                    '<a  class="apply"  style="text-align: center; color: white; font-size: 16px; font-family: Inter; font-weight: 600; line-height: 20.80px; word-wrap: break-word ; text-decoration:none;"  >Lihat</a>'+
                  '</div></td>' +
              '</tr> </table>   </div>';
    }

    function showDetail(id){
       sensorField.value = id;
       locationField.value = curData[id].location;
       tempField.value = curData[id].temp;
       humField.value = curData[id].hum;
       updateField.value = curData[id].last_updated;
    }

    function fetchData(){
        console.log("hallo");
        $.ajax({
            method : "get",
            url: "getdata",
            context: document.body
        }).done(function(e) {
            console.log(e);
            if(Object.keys(e).length > 0){
              dataArea.innerHTML = "";
            }
            const waktuSekarang = new Date();
            waktuSekarang.toLocaleString('en-US', { timeZone: 'Asia/Jakarta' })
            // Mendapatkan komponen waktu
            const tahun = waktuSekarang.getFullYear();
            const bulan = String(waktuSekarang.getMonth() + 1).padStart(2, '0'); // Perlu ditambah 1 karena indeks bulan dimulai dari 0
            const hari = String(waktuSekarang.getDate()).padStart(2, '0');
            const jam = String(waktuSekarang.getHours()).padStart(2, '0');
            const menit = String(waktuSekarang.getMinutes()).padStart(2, '0');
            const detik = String(waktuSekarang.getSeconds()).padStart(2, '0');
    
            // Membuat string dengan format yang diinginkan
            waktuFormatted = `${tahun}-${bulan}-${hari} ${jam}:${menit}:${detik}`;

            for(let data in e){
                curData[e[data].sensor_id] = e[data];
                console.log(e[data]);
                dataArea.innerHTML += card(e[data]);
            }
        }).fail((e)=>{
            console.log("Error :" );
            console.log(e);
        });;

        setTimeout(fetchData,10000);
    }

    fetchData();
</script>
</html>
